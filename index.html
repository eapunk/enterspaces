<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Enterspaces</title>
    <link rel="icon" type="image/png" href="favicon.png" sizes="16x16">
    <style type="text/css">
body {
    overflow: hidden;
    margin: 3px;
}
.toolbar > select, .toolbar > button {
    height: 24px;
}
#editor {
    font-size: 14px;
    line-height: 20px;
    margin: 0;
    position: absolute;
    top: 31px;
    bottom: 0;
    left: 0;
    right: 0;
    overflow: auto;
}
.ace_marker-layer .ace_selected-word {
    border-color: #5770c9 !important;
    border-width: 2px !important;
}
.ace_marker-layer .ace_bracket {
    border-color: #5770c9 !important;
}
.ace_line .ace_fold {
    color: #555 !important;
    width: inherit !important;
    height: inherit !important;
    margin: inherit !important;
    border: inherit !important;
    background: inherit !important;
}
    </style>
</head>
<body>
<div class="toolbar">
    <a href="index.html"><img src="favicon.png" alt="" title="Home" /></a>
    <select id="folding" title="Format" onchange="onChangeFormatSelect(this)">
                    <option data-construct="new Enterspaces.FoldToWidth(0)">Unfold All</option>
                    <option data-construct="new Enterspaces.FoldToWidth(80)"  data-ruler="80" >Fold to Width 80</option>
                    <option data-construct="new Enterspaces.FoldToWidth(120)" data-ruler="120">Fold to Width 120</option>
<option selected="selected" data-construct="new Enterspaces.FoldToWidth(150)" data-ruler="150">Fold to Width 150</option>
                    <option data-construct="new Enterspaces.FoldToWidth(220)" data-ruler="220">Fold to Width 220</option>
                    <option data-construct="new Enterspaces.UnfoldLevel(0)">Fold All</option>
                    <option data-construct="new Enterspaces.UnfoldLevel(1)">Unfold Level 1</option>
                    <option data-construct="new Enterspaces.UnfoldLevel(2)">Unfold Level 2</option>
                    <option data-construct="new Enterspaces.UnfoldLevel(3)">Unfold Level 3</option>
                    <option data-construct="new Enterspaces.UnfoldLevel(4)">Unfold Level 4</option>
                    <option data-construct="new Enterspaces.UnfoldLevel(5)">Unfold Level 5</option>
                    <option data-construct="new Enterspaces.UnfoldLevel(6)">Unfold Level 6</option>
                    <option data-construct="new Enterspaces.UnfoldLevel(7)">Unfold Level 7</option>
                    <option data-construct="new Enterspaces.UnfoldLevel(8)">Unfold Level 8</option>
                    <option data-construct="new Enterspaces.UnfoldLevel(9)">Unfold Level 9</option>
    </select>
    <button id="refresh" onclick="redraw()" title="Refresh" autocomplete="off">â†»</button>
</div>
<pre id="editor" contenteditable="true" spellcheck="false">
</pre>

<script src="enterspaces.min.js"></script>
<script>
var Enterspaces = window.Enterspaces;
var folding;
var editor;

function onChangeFormatSelect(select) {
    folding = eval(select.options[select.selectedIndex].dataset.construct);
    setRuler(select.options[select.selectedIndex].dataset.ruler)
    redraw();
}

function setRuler(column) {
    if (!editor) {
        return;
    }
    if (column) {
        editor.setPrintMarginColumn(column);
        editor.setShowPrintMargin(true);
    }
    else {
        editor.setShowPrintMargin(false);
    }
}

function redraw() {
    document.getElementById("refresh").disabled = true;
    setTimeout(_redraw, 10);
}

function _redraw() {
    var text = editor ? editor.getValue() : document.getElementById('editor').innerHTML;

    var newText = Enterspaces.prettify({folding: folding})(text || "");

    if (editor) {
        editor.setValue(newText, -1);
    }
    else {
        document.getElementById('editor').innerHTML = newText;
    }

    document.getElementById("refresh").disabled = false;
}

function handlePaste (e) {
    redraw();
}

document.addEventListener("DOMContentLoaded", function(event) {
    document.getElementById("folding").onchange();
    document.getElementById('editor').addEventListener('paste', handlePaste);
    document.getElementById('editor').focus();
});
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.3.0/ace.js" integrity="sha256-KnpXT25fqw7kpKElaD8u7A/Gg6jOr9G3x+1RuL+mo9E=" crossorigin="anonymous"></script>
<script>
var editor = ace.edit("editor");
editor.setTheme("ace/theme/textmate");
editor.session.setMode("ace/mode/haskell");

editor.session.addFold_orig = editor.session.addFold;
editor.session.addFold = function(placeholder, range) {
    placeholder = editor.getSession().doc.getTextRange(range)
        .replace(new RegExp('\n', 'g'), '')
        .replace(new RegExp('\\s+', 'g'), ' ')
        .substr(0, 300)
    return this.addFold_orig(placeholder, range);
};
document.addEventListener("DOMContentLoaded", function(event) {
    editor.focus();
});
</script>
</body>
</html>
